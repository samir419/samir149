<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Endless Runner</title>
  <style>
    canvas {
       border:solid;
       width:100%;
       height:auto;
       max-width: 1280px;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="1920" height="1080"></canvas>
   <p id="timer">time</p>
   <p id="highscore"></p>
   <button onclick="canvas.requestFullscreen()">fullscreen</button>
   <button onclick="if(isGameRunning==true){isGameRunning=false}else if(isGameRunning==false){isGameRunning=true}">pause</button>
   <h4>tap on the left for short jump. </h4>
   <h4>tap on the right for long jump</h4>
   <h4>tap the screen to revive after death</h4>
   <h3>swipe up to super jump</h3>
   <h3>swipe left to airdive</h3>
   <h3>swipe down to jump cancel</h3>
   <p>recommended to use fullscreen with landscape orientation</p>
  <script>
  //high and low and conectiong high low platforms
  //timing sections 
  //collectables at hard to reach spots
  
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  image = new Image()
  image.src = "jessi2.png"
  bg1 = new Image()
  bg1.src = "bg1.jpg"
   bg2 = new Image()
  bg2.src = "bg2.jpg"
  floor = new Image()
   floor.src="ground.jpg"
   obstacle_tile = new Image()
   obstacle_tile.src = "obstacle.jpg"
  rise = new Image()
   rise.src = "rise.jpg"
   if(!localStorage.getItem('highscore')){
    localStorage.setItem('highscore',JSON.stringify({score:0}))
   }
   document.getElementById('highscore').innerHTML= 'high score: '+JSON.parse(localStorage.getItem('highscore')).score
   let high_score = 0
   let game_speed = 15
   const music = new Audio('running game theme 01.mp3')
   let ismusicplaying = false;
    let bgx = 0
   let bgx2 = canvas.width

    const player = {
      x: 150,
      y: canvas.height - 600,
      width: 160,
      height: 160,
      color: "blue",
      dy: 0,
      dx:0, 
      gravity: 1.5,
      jumpStrength: -30,
      onGround: false,
      onPlatform:false
    };
   const special={x:1250,y:850,width:250,height:250}
   let vitality = 0

    const obstacles = Array.from({ length: 5 }, () => ({
      x: Math.random() * canvas.width+600,
      y: canvas.height - 320,
      width: 160,
      height: 160,
      speed: game_speed,
      color: "red",
      platform_x:0,
      platform_y:canvas.height-336,
      platform_height:30,
      platform_width:68*2.5
    }));
   
   const ground = Array.from({ length: 7 }, () => ({
      x: Math.random() * canvas.width,
      y: canvas.height-160,
      width: 160,
      height: 160,
      speed: game_speed,
      color: "red",
      platform_x:0,
      platform_y:canvas.height-176,
      platform_height:30,
      platform_width:68*2.5
    }));
   
     const highrises = Array.from({ length: 2 }, () => ({
      x: Math.random() * canvas.width+800,
      y: canvas.height - 480,
      width: 336,
      height: 160,
      speed: game_speed,
      color: "red",
      platform_x:0,
      platform_y:canvas.height-496,
      platform_height:50,
      platform_width:136*2.5
    }));

    let isGameRunning = true;
    let timer = 0

    function update() {
      if (!isGameRunning) return;
       bgx--
       bgx2--
       if(bgx<-canvas.width){
          bgx = canvas.width
       }
       if(bgx2<-canvas.width){
          bgx2=canvas.width
       }
       
       if(player.y>canvas.width){
           if(timer>JSON.parse(localStorage.getItem('highscore')).score){
                high_score=timer;
                localStorage.setItem('highscore',JSON.stringify({score:high_score}))

              }
          isGameRunning=false
       }
       if(player.dy<0){
           player.onGround=false
          }

      // Player physics
      player.dy += player.gravity;
      if(player.dx>0){
         player.dx--
      }  
      if(player.dx<0){
         player.dx++
      }          
      player.x += player.dx    
      player.y += player.dy;
          
      if(player.x<150){
         player.x+=3
      }else{
         player.x-=3
      }  

      // Update obstacles
      obstacles.forEach(obstacle => {
        obstacle.x -=game_speed;
        obstacle.platform_x = obstacle.x-4
         if(obstacle.speed<15){
            obstacle.speed++
         }
        if (obstacle.x + obstacle.width < 0) {
          obstacle.x = canvas.width + Math.random() * 200;
          //obstacle.y = canvas.height - Math.random()*200
          obstacle.platform_x = obstacle.x-4
          obstacle.platform_y = obstacle.y-32
        }

        // Collision detection
        if (
         player.x+32 < obstacle.x + obstacle.width &&
          player.x+32 + player.width-32 > obstacle.x &&
          player.y+32 < obstacle.y + obstacle.height &&
          player.y+32 + player.height-32 > obstacle.y 
          
        ) {
           if(player.y+player.height >=obstacle.y+obstacle.height-32){
            if(timer>JSON.parse(localStorage.getItem('highscore')).score){
                high_score=timer;
                localStorage.setItem('highscore',JSON.stringify({score:high_score}))

              }
              isGameRunning = false;
           }
           player.dx = -10
           //obstacle.speed-=10
           timer -=20
            //obstacle.x += obstacle.speed
       
          
        }
            if (
          player.x < obstacle.platform_x + obstacle.platform_width &&
          player.x + player.width > obstacle.platform_x &&
          player.y < obstacle.platform_y + obstacle.platform_height &&
          player.y + player.height > obstacle.platform_y
        ) {
          player.y = obstacle.platform_y-player.height
          player.dy=0
          player.onPlatform = true
           player.onGround=true
           vitality = 1
        }
           if(player.y+player.height<obstacle.platform_y-10){
              player.onPlatform=false
            }
      });
       
        ground.forEach(obstacle => {
        obstacle.x -= game_speed;
        obstacle.platform_x = obstacle.x-4
        if(obstacle.speed<15){
            obstacle.speed++
         }
        if (obstacle.x + obstacle.width < 0) {
          obstacle.x = canvas.width + Math.random() * 200;
          //obstacle.y = canvas.height - Math.random()*200
          obstacle.platform_x = obstacle.x-4
          obstacle.platform_y = obstacle.y-32
        }

        // Collision detection
        if (
         player.x+32 < obstacle.x + obstacle.width &&
          player.x+32 + player.width-32 > obstacle.x &&
          player.y+32 < obstacle.y + obstacle.height &&
          player.y+32 + player.height-32 > obstacle.y     
        ) {

            if(player.y+player.height >=obstacle.y+obstacle.height-32){
              if(timer>JSON.parse(localStorage.getItem('highscore')).score){
                high_score=timer;
                localStorage.setItem('highscore',JSON.stringify({score:high_score}))

              }
              isGameRunning = false;
           }
           player.dx = -10
           //obstacle.speed-=10
           timer-=20
            //obstacle.x += obstacle.speed
       
          
        }
            if (
          player.x < obstacle.platform_x + obstacle.platform_width &&
          player.x + player.width > obstacle.platform_x &&
          player.y < obstacle.platform_y + obstacle.platform_height &&
          player.y + player.height > obstacle.platform_y
        ) {
          player.y = obstacle.platform_y-player.height
          player.dy=0
          player.onPlatform = true
          player.onGround=true 
          vitality = 1
        }
           if(player.y+player.height<obstacle.platform_y-10){
              player.onPlatform=false
            }
      });
       
          
      highrises.forEach(obstacle => {
        obstacle.x -= game_speed;
        obstacle.platform_x = obstacle.x-12
         if(obstacle.speed<15){
            obstacle.speed++
         }
        if (obstacle.x + obstacle.width < 0) {
          obstacle.x = canvas.width + Math.random() * 200;
          //obstacle.y = canvas.height - Math.random()*200
          obstacle.platform_x = obstacle.x-8
          obstacle.platform_y = obstacle.y-32
        }

        // Collision detection
        if (
         player.x+32 < obstacle.x + obstacle.width &&
          player.x+32 + player.width-32 > obstacle.x &&
          player.y+32 < obstacle.y + obstacle.height &&
          player.y+32 + player.height-32 > obstacle.y      
        ) {

            if(player.y+player.height >=obstacle.y+obstacle.height-32){
              if(timer>JSON.parse(localStorage.getItem('highscore')).score){
                high_score=timer;
                localStorage.setItem('highscore',JSON.stringify({score:high_score}))

              }
              isGameRunning = false;
           }
           player.dx = -20
           //obstacle.speed -= 10
           timer-=20
            //obstacle.x += obstacle.speed
       
          
        }
            if (
          player.x < obstacle.platform_x + obstacle.platform_width &&
          player.x + player.width > obstacle.platform_x &&
          player.y < obstacle.platform_y + obstacle.platform_height &&
          player.y + player.height > obstacle.platform_y
        ) {
          player.y = obstacle.platform_y-player.height
          player.dy=0
          player.onPlatform = true
          vitality = 1
        }
           if(player.y+player.height<obstacle.platform_y-10){
              player.onPlatform=false
            }
      });
      if(timer%2000==0&&game_speed<=35){
        game_speed++
      }
      timer++
      document.getElementById("timer").innerHTML = timer
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      ctx.drawImage(bg1,bgx,0,canvas.width,canvas.height+200);
      ctx.drawImage(bg2,bgx2,0,canvas.width,canvas.height+200);

      // Draw player
      ctx.fillStyle = player.color;
      ctx.drawImage(image,player.x, player.y,player.width,player.height);

      // Draw obstacles
      obstacles.forEach(obstacle => {
        ctx.fillStyle = obstacle.color;
        ctx.drawImage(obstacle_tile,obstacle.x, obstacle.y, obstacle.width, obstacle.height);
        ctx.fillStyle="green"
        //ctx.fillRect(obstacle.platform_x,obstacle.platform_y,obstacle.platform_width,obstacle.platform_height)
      });
         highrises.forEach(obstacle => {
        ctx.fillStyle = obstacle.color;
        ctx.drawImage(rise,obstacle.x, obstacle.y, obstacle.width, obstacle.height);
        ctx.fillStyle="green"
        //ctx.fillRect(obstacle.platform_x,obstacle.platform_y,obstacle.platform_width,obstacle.platform_height)
      });
        ground.forEach(obstacle => {
        ctx.fillStyle="green"
        //ctx.fillRect(obstacle.platform_x,obstacle.platform_y,obstacle.platform_width,obstacle.platform_height
        ctx.drawImage(floor,obstacle.x, obstacle.y, obstacle.width, obstacle.height);
        
      });
       
    }
   
   

    function resetGame() {
      timer = 0
      game_speed=15
      player.y = canvas.height - 700;
      player.dy = 0;
      isGameRunning = true;
      document.getElementById('highscore').innerHTML= 'high score: '+JSON.parse(localStorage.getItem('highscore')).score
      music.play()
      ismusicplaying=true
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    document.addEventListener('keydown', move);


     function move(e) {
         switch(e.key){
             case 'w':
             if(player.onGround||player.onPlatform){
                      player.dy = player.jumpStrength;
                  }
                 break;
            case 'Enter': resetGame();
            break;

            case 'q':
             if(player.onGround||player.onPlatform){
                      shortjump()
                  }
                 break;
            case 'e':
             if(vitality==1){
                      special1();
                      vitality=0
                  }
                 break;
            case 'd':
             if(!player.onGround||!player.onPlatform){
                      airdive();
                  }
                 break;
            case 's':
             if(!player.onGround||!player.onPlatform){
                     herolanding();
                  }
                 break;
            case 'p':
            if(isGameRunning==true){isGameRunning=false}else if(isGameRunning==false){isGameRunning=true}
            if(ismusicplaying){ music.pause(); ismusicplaying=false}else{music.play();ismusicplaying=true}
           
                 break;
            
        }
        
    }
    

  
     canvas.addEventListener("touchstart", function(event) {
          const touch = event.touches[0];

    
          const touch_x = touch.clientX; 
          const touch_y = touch.clientY; 
          if(touch_x<400){
             if(player.onGround||player.onPlatform){
                player.dy = -20;
              }
              if(!isGameRunning){resetGame()}
          }else{
             if(touch_x>=special.x && touch_x<=scpecial.x+special.width &&
                touch_y>=special.y && touch_y <=special.y+special.height){
                   player.dy = -30
                   player.dx = 30
                   console.log("special")
                }else {
                   if(player.onGround||player.onPlatform){
                      player.dy = player.jumpStrength;
                  }
                }
            if(!isGameRunning){resetGame()}
          }
         
           
            // Prevent default behavior (to avoid zooming, etc.)
            event.preventDefault();
        });
   let startX = 0;
    let startY = 0;
   let endX = 0;
    let endY = 0;

    // Touchstart event listener
    canvas.addEventListener('touchstart', (event) => {
      const touch = event.touches[0];
      startX = touch.clientX;
      startY = touch.clientY;
    });

    // Touchend event listener
    canvas.addEventListener('touchend', (event) => {
      const touch = event.changedTouches[0];
      endX = touch.clientX;
      endY = touch.clientY;

      handleSwipe();
    });

    function handleSwipe() {
      const diffX = endX - startX;
      const diffY = endY - startY;

      if (Math.abs(diffX) > Math.abs(diffY)) {
        if (diffX > 30) {
           airdive()
        } else if (diffX < -30) {
          if(isGameRunning==true){isGameRunning=false}else if(isGameRunning==false){isGameRunning=true}
        }
      } else {
        if (diffY > 30) {
          herolanding()
        } else if (diffY < -30) {
         if(vitality==1){
          special1()
          vitality=0
         }
        }
      }
    }

    gameLoop();
   
   function special1(){
      player.dx = 30
      player.dy = -30
   }
   function shortjump(){
      player.dy = -20
   }
   function jump(){
      player.dy = -30
   }
   function airdive(){
      player.dy = 10
      player.dx = 30
   }
   function herolanding(){
      player.dy = 30
      player.dx = 0
   }
  </script>
</body>
</html>
